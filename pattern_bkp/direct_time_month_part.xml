<?xml version="1.0" encoding="utf-8" standalone="yes"?>

<pattern>
	<name>Month part</name>
	<description>
		Identify, whether it's the beginning, middle or end of the month.
	</description>
	<author>Jan Motl</author>
	<date>2015-06-01</date>
	<code compatibility="PostgreSQL">SELECT @baseId
			     , @baseDate
			     , @baseTarget
			     , CEIL(day/days_in_month*3) AS "@columnName"
			FROM (
				SELECT @baseId
			     	, @baseDate
			     	, @baseTarget
					, EXTRACT(DAY FROM @timeColumn) AS day 
					, DATE_PART('day', 
				        DATE_TRUNC('MONTH', @timeColumn) 
				        + '1 MONTH'::INTERVAL 
				        - '1 DAY'::interval
			    ) AS days_in_month
				FROM @propagatedTable
			) t
	</code>
	<cardinality>1</cardinality>
</pattern>