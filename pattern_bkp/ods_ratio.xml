<?xml version="1.0" encoding="utf-8" standalone="yes"?>

<pattern>
	<name>Odds ratio</name>
	<description>
		The pattern is from: Feature selection for unbalanced class distribution and Naive Bayes, Mladenic &amp; Grobelnik.

		NOTE: SHOULD BE VALIDATED (LIKE TREATMENT OF NULLS).

		NOTE: TARGET VALUES SHOULD BE ESCAPED IN PF - if target is numerical, do not escape, if nominal, escape with
		the right escape character.
	</description>
	<author>Jan Motl</author>
	<date>2015-07-09</date>
	<code>SELECT t1.@base
			, oddsRatio AS "@columnName"
		FROM @propagatedTable t1
		JOIN (
			SELECT COALESCE(tp.@column, fp.@column) as @column, (tp*(negative-fp)*1.0)/(fp*(positive-tp)) as oddsRatio
			FROM (
				SELECT @column, count(*) as tp
				FROM @propagatedTable
				WHERE @baseTarget = '@targetValue'
				GROUP BY @column
			) tp
			FULL JOIN (
				SELECT @column, count(*) as fp
				FROM @propagatedTable
				WHERE @baseTarget &lt;&gt; '@targetValue'
				GROUP BY @column
			) fp
			ON tp.@column = fp.@column
			, (
				SELECT count(*) as negative
				FROM @propagatedTable
				WHERE @baseTarget &lt;&gt; '@targetValue'
			) negative
			, (
				SELECT count(*) as positive
				FROM @propagatedTable
				WHERE @baseTarget = '@targetValue'
			) positive
		) t2
		ON t1.@column = t2.@column
	</code>
	<parameter key="@column" value="@nominalColumn,@idColumn"/>
	<cardinality>1</cardinality>
</pattern>
