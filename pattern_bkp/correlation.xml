<?xml version="1.0" encoding="utf-8" standalone="yes"?>

<pattern>
	<name>Correlation</name>
	<description>
		Calculate Pearson correlation of an attribute with time.
	
		Note: correlation of an attribute with another attribute will be implemented in a separate pattern because
		time columns must be casted in some of the databases to a numerical columns. Hence the syntax differs. 
		
		Note: functions "corr" and "dateToNumber" are automatically converted based on the target database. MySQL
		has it's own implementation because in this case MySQL doesn't require conversion of dates to numbers.

	</description>
	<author>Jan Motl</author>
	<date>2014-12-22</date>
	<code compatibility="Default,Oracle,PostgreSQL">SELECT @baseId
	           , @baseDate
	           , @baseTarget
	           , corr(dateToNumber(@timeColumn), @numericalColumn) AS "@columnName"
	      FROM @propagatedTable
	      GROUP BY @baseId, @baseDate, @baseTarget
	</code>
	<code compatibility="MySQL">SELECT @baseId
	           , @baseDate
	           , @baseTarget
	           , (Avg(@numericalColumn * @timeColumn) - Avg(@numericalColumn) * Avg(@timeColumn)) / (StdDev_Samp(@numericalColumn) * StdDev_Samp(@timeColumn)) AS "@columnName"
	      FROM @propagatedTable
	      GROUP BY @baseId, @baseDate, @baseTarget
	</code>
	<cardinality>n</cardinality>
</pattern>
