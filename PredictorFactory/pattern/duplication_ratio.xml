<?xml version="1.0" encoding="utf-8" standalone="yes"?>

<pattern>
	<name>Duplication ratio</name>
	<description>
		Proportion of records with a duplicate value.
		
		Note: It's different from concentration pattern.
	</description>
	<author>Jan Motl</author>
	<date>2015-03-04</date>
	<code>SELECT t1.@baseId
			   , t1.@baseDate
			   , t1.@baseTarget
		       , COALESCE(Sum(t2.nrow)/t1.nrow, 0) AS "@columnName"
		  FROM (
		  		SELECT @baseId
					 , @baseDate
					 , @baseTarget
		       		 , Count(*) AS nrow
			    FROM @propagatedTable
			    GROUP BY @baseId, @baseDate, @baseTarget
			    ) t1
		  LEFT JOIN (
		  		SELECT @baseId
					 , @baseDate
	  				 , Count(*) AS nrow
		        FROM @propagatedTable
		        GROUP BY @baseId, @baseDate, @baseTarget, @column
		        HAVING Count(*) >= 2
		        ) t2
		  ON t1.@baseId = t2.@baseId AND t1.@baseDate = t2.@baseDate
		  GROUP BY t1.@baseId, t1.@baseDate, t1.@baseTarget, t1.nrow
	</code>
    <parameter key="@column" value="@nominalColumn, @numericalColumn"/>
	<cardinality>n</cardinality>
</pattern>
